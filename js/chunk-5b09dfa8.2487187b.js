(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5b09dfa8"],{6741:function(e,t,s){"use strict";s("a0da")},"69f1":function(e,t,s){"use strict";s("7108")},7108:function(e,t,s){},"8e2a":function(e,t,s){"use strict";s.r(t);var a,i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"h-100 row"},[s("NavBar",{staticClass:"col-md-2",on:{"after-show-tweet-modal":e.afterShowTweetModal}}),s("div",{staticClass:"col-md-10 d-flex h-100"},[s("div",{staticClass:"message-users"},[s("MessageUserCards",{attrs:{rooms:e.rooms},on:{"change-room-id":e.changeRoomId}})],1),s("div",{staticClass:"message-content"},[e.thisMessageName.length?s("div",{staticClass:"message-content-title"},[s("p",{staticClass:"message-content-name"},[e._v(e._s(e.thisMessageName[0].name))]),s("span",{staticClass:"message-content-account"},[e._v("@"+e._s(e.thisMessageName[0].account))])]):s("div",{staticClass:"message-content-title"}),e.thisMessageName.length?s("div",{staticClass:"chatroom-container"},[s("div",{staticClass:"display-container"},[e._l(e.messages,(function(t){return s("div",{key:t.index,class:{notification:1===t.typeId,"card-other":2===t.typeId,"card-self":3===t.typeId}},[1===t.typeId?s("span",[e._v(e._s(t.content))]):e._e(),2===t.typeId?s("div",{staticClass:"card-other-container"},[s("div",{staticClass:"img-container"},[s("img",{attrs:{src:e._f("emptyImage")(t.avatar),alt:"avatar"}})]),s("div",{staticClass:"content-container"},[s("div",{staticClass:"text"},[e._v(" "+e._s(t.content)+" ")]),s("p",{staticClass:"time"},[e._v(e._s(e._f("formatDate")(t.time)))])])]):e._e(),3===t.typeId?s("div",{staticClass:"card-self-container"},[s("div",{staticClass:"text"},[e._v(" "+e._s(t.content)+" ")]),s("p",{staticClass:"time"},[e._v(e._s(e._f("formatDate")(t.time)))])]):e._e()])})),e.previousMessages.length>0?e._l(e.previousMessages,(function(t){return s("div",{key:t.index,class:{notification:1===t.typeId,"card-other":2===t.typeId,"card-self":3===t.typeId}},[1===t.typeId?s("span",[e._v(e._s(t.content))]):e._e(),2===t.typeId?s("div",{staticClass:"card-other-container"},[s("div",{staticClass:"img-container"},[s("img",{attrs:{src:e._f("emptyImage")(t.avatar),alt:"avatar"}})]),s("div",{staticClass:"content-container"},[s("div",{staticClass:"text"},[e._v(" "+e._s(t.content)+" ")]),s("p",{staticClass:"time"},[e._v(e._s(e._f("formatDate")(t.time)))])])]):e._e(),3===t.typeId?s("div",{staticClass:"card-self-container"},[s("div",{staticClass:"text"},[e._v(" "+e._s(t.content)+" ")]),s("p",{staticClass:"time"},[e._v(e._s(e._f("formatDate")(t.time)))])]):e._e()])})):e._e()],2),s("div",{staticClass:"input-container"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.inputMessage,expression:"inputMessage"}],attrs:{type:"text",placeholder:"輸入訊息..."},domProps:{value:e.inputMessage},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendMessage.apply(null,arguments)},input:function(t){t.target.composing||(e.inputMessage=t.target.value)}}}),s("button",{on:{click:e.sendMessage}},[s("img",{attrs:{src:"https://i.imgur.com/Jrjlukd.jpg",alt:""}})])])]):s("div",{staticClass:"chatroom-container"},[e._m(0),e._m(1)])])]),e.showModal?s("TweetModal",{on:{"after-hide-modal":e.afterHideModal}}):e._e()],1)},n=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"display-container-text"},[s("div",{staticClass:"display-container-img"},[s("img",{attrs:{src:"https://i.imgur.com/VG0wE3w.jpg"}})])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"input-container"},[s("input",{staticClass:"input-container-cursor-not-allowed",attrs:{type:"text",placeholder:"無法輸入訊息...",disabled:""}}),s("button",{staticClass:"input-container-cursor-not-allowed"},[s("img",{attrs:{src:"https://i.imgur.com/Jrjlukd.jpg"}})])])}],o=s("ade3"),c=s("5530"),r=s("d000"),d=s("4287"),l=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"message"},[s("p",{staticClass:"message-title"},[e._v("訊息")]),s("div",{staticClass:"message-cards"},e._l(e.rooms,(function(t){return s("div",{key:t.index,staticClass:"message-card d-flex justify-content-start align-items-center",on:{click:function(s){return s.stopPropagation(),s.preventDefault(),e.getPrivateMessages(t.id)}}},[s("img",{staticClass:"message-card-img",attrs:{src:e._f("emptyImage")(t.receiver.avatar)}}),s("div",{staticClass:"message-content"},[s("p",{staticClass:"message-name"},[e._v(" "+e._s(t.receiver.name)+" "),s("span",{staticClass:"message-account"},[e._v(" @"+e._s(t.receiver.account)+" ")])]),s("p",{staticClass:"message-description"},[e._v(e._s(t.receiver.introduction))])]),s("div",{staticClass:"message-time"},[e._v(e._s(e._f("fromNow")(t.createdAt)))])])})),0)])},m=[],g=s("2708"),u={name:"MessageUsersCards",mixins:[g["a"],g["c"]],props:{rooms:{type:Array,required:!0}},methods:{getPrivateMessages:function(e){this.$socket.client.emit("get private messages",e),this.$emit("change-room-id",e),console.log("get private messages: ".concat(e))}}},p=u,v=(s("69f1"),s("2877")),f=Object(v["a"])(p,l,m,!1,null,"c979f010",null),h=f.exports,_=s("2f62"),C={name:"Message",components:{NavBar:r["a"],TweetModal:d["a"],MessageUserCards:h},data:function(){return{showModal:!1,messages:[],inputMessage:"",rooms:[],previousMessages:[],currentRoomId:-1,thisMessageName:[]}},computed:Object(c["a"])({},Object(_["b"])(["currentUser"])),mixins:[g["a"],g["b"]],methods:{afterShowTweetModal:function(){this.showModal=!0},afterHideModal:function(){this.showModal=!1},changeRoomId:function(e){console.log("newRoomId",e),this.currentRoomId!==e&&(this.currentRoomId=e,this.messages=[])},sendMessage:function(){this.inputMessage&&(console.log("sendMessage: ",this.inputMessage),this.$socket.client.emit("private message",{roomId:this.currentRoomId,message:this.inputMessage}),this.inputMessage="")},connectUser:function(){console.log("進入私人聊天室"),this.$socket.client.emit("enter private room")},disconnectUser:function(){console.log("離開私人聊天室"),this.$socket.client.emit("leave chatroom")}},sockets:(a={},Object(o["a"])(a,"private message list",(function(e){console.log("接收私信使用者的列表: ",e),this.rooms=e,this.currentRoomId=e[0].id})),Object(o["a"])(a,"render private messages",(function(e){console.log("獲取歷史訊息: ",e),this.previousMessages=[],this.thisMessageName=[],this.thisMessageName.push(e.otherUser);for(var t=0;t<e.messages.length;t++){var s=e.messages[t];if(s.senderId===this.currentUser.id){var a={id:-1,content:s.message,typeId:3,type:"self",time:s.createdAt,avatar:""};this.previousMessages.unshift(a)}else{var i={id:-1,content:s.message,typeId:2,type:"other",time:s.createdAt,avatar:s.Receiver.avatar};this.previousMessages.unshift(i)}}})),Object(o["a"])(a,"private message",(function(e){if(console.log("接收私人訊息: ",e),e.senderId===this.currentUser.id){var t={id:-1,content:e.message,typeId:3,type:"self",time:e.createdAt,avatar:""};this.messages.unshift(t)}else{var s={id:-1,content:e.message,typeId:2,type:"other",time:e.createdAt,avatar:e.senderAvatar};this.messages.unshift(s)}})),a),created:function(){this.connectUser()},beforeDestroy:function(){this.disconnectUser(),this.$socket.client.off("render private messages"),this.$socket.client.off("private message list"),this.$socket.client.off("private message")}},M=C,y=(s("6741"),Object(v["a"])(M,i,n,!1,null,"fc839f76",null));t["default"]=y.exports},a0da:function(e,t,s){}}]);
//# sourceMappingURL=chunk-5b09dfa8.2487187b.js.map